{"version":3,"file":"index-a19ba0c3.js","sources":["../../../../pages/Login/index.vue"],"sourcesContent":["<template>\n  <div id=\"app\" v-cloak>\n    <div v-if=\"isCheckingLogin\">\n      <h1>Provjera prijave...</h1>\n    </div>\n    <div v-else>\n      <div v-if=\"isLoggedIn\">\n        <h1>Prijavljeni ste</h1>\n      </div>\n      <div class=\"login-container\" v-else>\n        <h1 class=\"title\">Domaći recepti</h1>\n        <input class=\"input-field\" type=\"text\" placeholder=\"Unesi ime\" v-model=\"korisnicko_ime\" :disabled=\"isCheckingLogin\" required />\n        <p v-if=\"errors.korisnicko_ime\" class=\"error-message\">{{ errors.korisnicko_ime }}</p>\n\n        <input class=\"input-field\" type=\"password\" placeholder=\"Unesi lozinku\" v-model=\"lozinka\" :disabled=\"isCheckingLogin\" required />\n        <p v-if=\"errors.lozinka\" class=\"error-message\">{{ errors.lozinka }}</p>\n\n        <button class=\"login-button\" @click.prevent=\"prijavi\" :disabled=\"isCheckingLogin\">Prijavi se</button>\n        <p v-if=\"errors.general\" class=\"error-message\">{{ errors.general }}</p>\n        <div class=\"register-container\">\n          <p>Nemaš račun? <router-link to=\"/register\" class=\"register-button\">Registriraj se</router-link></p>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { nextTick } from 'vue';\nimport accountStore from '@/composables/accountStore'; \n\nexport default {\n  data() {\n    return {\n      korisnicko_ime: '',\n      lozinka: '',\n      isLoggedIn: false,\n      isCheckingLogin: true,\n      errors: {\n        korisnicko_ime: '',\n        lozinka: '',\n        general: ''\n      }\n    }\n  },\n  async created() {\n    try {\n      this.isLoggedIn = await accountStore.getters.isLoggedIn();\n      if (this.isLoggedIn) {\n        await nextTick();\n        window.location.href = '/';\n      }\n    } catch (error) {\n      console.error('Error during login check:', error);\n    } finally {\n      this.isCheckingLogin = false;\n    }\n  },\n  methods: {\n    async prijavi() {\n      if (this.isCheckingLogin) return;\n\n      // Reset errors\n      this.errors = { korisnicko_ime: '', lozinka: '', general: '' };\n\n      // Frontend validation\n      if (!this.korisnicko_ime) {\n        this.errors.korisnicko_ime = 'Korisničko ime je obavezno';\n      }\n      if (!this.lozinka) {\n        this.errors.lozinka = 'Lozinka je obavezna';\n      }\n      if (this.errors.korisnicko_ime || this.errors.lozinka) {\n        return;\n      }\n\n      try {\n        await fetch('http://localhost:8000/sanctum/csrf-cookie');\n        const response = await fetch('http://localhost:8000/api/prijavi', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            korisnicko_ime: this.korisnicko_ime,\n            lozinka: this.lozinka\n          })\n        });\n        const data = await response.json();\n        if (response.ok) {\n          document.cookie = `authToken=${data.access_token}; path=/`;\n          document.cookie = `username=${this.korisnicko_ime}; path=/`;\n          document.cookie = `email=${data.korisnik.email}; path=/`;\n          this.isLoggedIn = true;\n          await nextTick();\n          if (data.korisnik.uloga_id == 2 || data.korisnik.uloga_id ) {\n            window.location.href = '/admin';\n          } else {\n            window.location.href = '/';\n          }\n        } else {\n          this.errors = data.errors || {};\n        }\n      } catch (error) {\n        this.errors.general = 'Došlo je do greške prilikom prijave: ' + error.message;\n        console.error('Detalji greške: ', error);\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\nbody {\n  background-color: #FFA07A;\n}\n\n#app {\n  height: 100vh;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.login-container {\n  background-color: white;\n  padding: 20px;\n  border-radius: 10px;\n  width: 100%;\n  max-width: 500px;\n  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);\n}\n\n.title {\n  text-align: center;\n  margin-bottom: 20px;\n  font-size: 1.5em;\n}\n\n.input-field {\n  width: 100%;\n  padding: 15px;\n  margin-bottom: 10px;\n  border-radius: 5px;\n  border: 1px solid #ccc;\n  font-size: 1em;\n}\n\n.login-button {\n  width: 100%;\n  padding: 15px;\n  background-color: #FFA07A;\n  color: white;\n  border: none;\n  border-radius: 5px;\n  cursor: pointer;\n  font-size: 1em;\n  margin-top: 10px;\n}\n\n.register-container {\n  margin-top: 10px;\n  text-align: center;\n}\n\n.register-button {\n  color: #FFA07A;\n  text-decoration: none;\n}\n\n.error-message {\n  color: red;\n  margin-bottom: 10px;\n}\n\n[v-cloak] {\n  display: none;\n}\n</style>\n"],"names":["_ssrRenderAttrs","_mergeProps","_ssrInterpolate","_push","_parent"],"mappings":";;;;;;;;;;;;;;;;;;;;AA+BA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,gBAAgB;AAAA,MAChB,SAAS;AAAA,MACT,YAAY;AAAA,MACZ,iBAAiB;AAAA,MACjB,QAAQ;AAAA,QACN,gBAAgB;AAAA,QAChB,SAAS;AAAA,QACT,SAAS;AAAA,MACX;AAAA,IACF;AAAA,EACD;AAAA,EACD,MAAM,UAAU;AACd,QAAI;AACF,WAAK,aAAa,MAAM,aAAa,QAAQ,WAAU;AACvD,UAAI,KAAK,YAAY;AACnB,cAAM,SAAQ;AACd,eAAO,SAAS,OAAO;AAAA,MACzB;AAAA,IACA,SAAO,OAAO;AACd,cAAQ,MAAM,6BAA6B,KAAK;AAAA,IAClD,UAAU;AACR,WAAK,kBAAkB;AAAA,IACzB;AAAA,EACD;AAAA,EACD,SAAS;AAAA,IACP,MAAM,UAAU;AACd,UAAI,KAAK;AAAiB;AAG1B,WAAK,SAAS,EAAE,gBAAgB,IAAI,SAAS,IAAI,SAAS;AAG1D,UAAI,CAAC,KAAK,gBAAgB;AACxB,aAAK,OAAO,iBAAiB;AAAA,MAC/B;AACA,UAAI,CAAC,KAAK,SAAS;AACjB,aAAK,OAAO,UAAU;AAAA,MACxB;AACA,UAAI,KAAK,OAAO,kBAAkB,KAAK,OAAO,SAAS;AACrD;AAAA,MACF;AAEA,UAAI;AACF,cAAM,MAAM,2CAA2C;AACvD,cAAM,WAAW,MAAM,MAAM,qCAAqC;AAAA,UAChE,QAAQ;AAAA,UACR,SAAS;AAAA,YACP,gBAAgB;AAAA,UACjB;AAAA,UACD,MAAM,KAAK,UAAU;AAAA,YACnB,gBAAgB,KAAK;AAAA,YACrB,SAAS,KAAK;AAAA,WACf;AAAA,QACH,CAAC;AACD,cAAM,OAAO,MAAM,SAAS;AAC5B,YAAI,SAAS,IAAI;AACf,mBAAS,SAAS,aAAa,KAAK,YAAY;AAChD,mBAAS,SAAS,YAAY,KAAK,cAAc;AACjD,mBAAS,SAAS,SAAS,KAAK,SAAS,KAAK;AAC9C,eAAK,aAAa;AAClB,gBAAM,SAAQ;AACd,cAAI,KAAK,SAAS,YAAY,KAAK,KAAK,SAAS,UAAW;AAC1D,mBAAO,SAAS,OAAO;AAAA,iBAClB;AACL,mBAAO,SAAS,OAAO;AAAA,UACzB;AAAA,eACK;AACL,eAAK,SAAS,KAAK,UAAU,CAAA;AAAA,QAC/B;AAAA,MACA,SAAO,OAAO;AACd,aAAK,OAAO,UAAU,0CAA0C,MAAM;AACtE,gBAAQ,MAAM,oBAAoB,KAAK;AAAA,MACzC;AAAA,IACF;AAAA,EACF;AACF;;;AA5GO,QAAA,OAAAA,eAAAC,WAAA,EAAA,IAAG,SAAK,MAAA,CAAA,CAAA,mBAAA;MACA,MAAe,iBAAA;;;;QAIb,MAAU,YAAA;;;sMAKqD,MAAc,cAAA,0BAAa,MAAe,eAAA,IAAA,cAAA;AACzG,UAAA,MAAA,OAAO,gBAAc;AAA2B,cAAA,4CAAAC,eAAA,MAAA,OAAO,cAAc,CAAA,MAAA;AAAA;;;4GAEE,MAAO,OAAA,0BAAa,MAAe,eAAA,IAAA,cAAA;AAC1G,UAAA,MAAA,OAAO,SAAO;AAA2B,cAAA,4CAAAA,eAAA,MAAA,OAAO,OAAO,CAAA,MAAA;AAAA;;;iEAEC,MAAe,eAAA,IAAA,cAAA,EAAA,sCAAA;AACvE,UAAA,MAAA,OAAO,SAAO;AAA2B,cAAA,4CAAAA,eAAA,MAAA,OAAO,OAAO,CAAA,MAAA;AAAA;;;;;QAEjC,IAAG;AAAA,QAAY,OAAM;AAAA;yBAAlC,CAAgF,GAAAC,QAAAC,UAAA,aAAA;;;;;8BAA5B,gBAAc;AAAA;;;;;;;;;;;;;;;;;;"}